function activateScrollToLinks(){$("[class^=scroll-to-]").each(function(){$(this).click(function(){$("body,html").stop(!0,!0).animate({scrollTop:$("input[name="+$(this).attr("class").substr(10)+"]").offset().top-$("header").height()},"500","swing"),$("input[name="+$(this).attr("class").substr(10)+"]").focus()})})}function activateCloseTabLinks(){$(".close-tab").each(function(){$(this).click(function(){confirm("Close tab? You will return to the parameter settings page. Alternatively, to preserve your results and re-run the model with a different set of parameters, click Cancel, switch to the parameter settings tab, update your inputs, and re-submit the form. Your updated results will open in a new tab.")&&close()})})}function addThousandsComma(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function currencyFormat(e){var a;return e>0?a="$"+addThousandsComma(e):0>e?a="-$"+addThousandsComma(parseInt(-1*e)):0==e&&(a="0"),a}function focusCustomParameters(){$(".param-row").each(function(){$(this).click(function(){$(this).find("input").focus()})}),$(".param-row input").each(function(){$(this).focus(function(){$(this).select(),$(this).parents(".param-row").addClass("focused")}),$(this).focusout(function(){$(this).val($(this).val().replace(/[^0-9.]/g,"")),$(this).parents(".param-row").removeClass("focused")})})}function goBack(e){console.log("trying to go back");var a="http://maxnorton.github.io/figure",s=window.location.hash;history.back();var t=window.location.hash;return t!==s||"string"==typeof document.referrer&&""!==document.referrer||window.setTimeout(function(){window.location.href=a},1e3),e&&(e.preventDefault&&e.preventDefault(),e.preventPropagation&&e.preventPropagation()),!1}function checkHash(){var e=window.location.hash?window.location.hash:!1;e&&$("body,html").stop(!0,!0).animate({scrollTop:$(e).offset().top},"1000","swing")}function mobileSubstitutions(){$(window).width()<1023&&($(".efficacy-info .table-style").html('<a href="img/efficacy-table01.png" class="swipebox"><i class="fa fa-table" aria-hidden="true"></i> Open reference table'),$(".variable-definitions table:nth-of-type(3)").html('<a href="img/variable-table03.png" class="swipebox"><i class="fa fa-table" aria-hidden="true"></i> Open reference table').css("border","0 none"),$(".hide-for-tablets").css("display","none").removeClass("swipebox")),$(window).width()<768&&($(".variable-definitions table:nth-of-type(1)").html('<a href="img/variable-table01.png" class="swipebox"><i class="fa fa-table" aria-hidden="true"></i> Open reference table').css("border","0 none"),$(".variable-definitions table:nth-of-type(2)").html('<a href="img/variable-table02.png" class="swipebox"><i class="fa fa-table" aria-hidden="true"></i> Open reference table').css("border","0 none"),$(".custom-instructions table:nth-of-type(1)").html('<a href="img/custom-instructions-table01.png" class="swipebox"><i class="fa fa-table" aria-hidden="true"></i> Open reference table').css("border","0 none"),$(".custom-instructions table:nth-of-type(2)").html('<a href="img/custom-instructions-table02.png" class="swipebox"><i class="fa fa-table" aria-hidden="true"></i> Open reference table').css("border","0 none"),$(".hide-for-phones").css("display","none").removeClass("swipebox"))}function scrollToHash(){if(window.location.hash){var e=window.location.hash;$("body,html").stop(!0,!0).animate({scrollTop:$(e).offset().top-$("header").height()},"500","swing")}}function styleGlossaryLinks(){$(".glossary-icon").each(function(){$(this).empty()}),$(".glossary-link").prepend('<span class="glossary-icon"><i class="fa fa-question-circle"></i></span>'),$(".glossary-link-family").prepend('<span class="glossary-icon"><i class="fa fa-question-circle"></i></span>'),$(".glossary-link-inline-child").click(function(e){e.preventDefault(),$(this).stop().find(".glossary-inline").toggle("fast")}),$(".glossary-link-inline-sibling").click(function(e){e.preventDefault(),$(this).stop().parents(".glossary-link-family").find(".glossary-inline").toggle("fast")})}function toggleFormOptions(){"yield"===$("input[name=figuredisplay]:checked").val()&&($(".disable-on-yield-alert").slideDown("fast"),$("input[name=pc]").add("input[name^=cost]").add("input[name=price]").add("input[name=discount]").each(function(){$(this).prop("disabled",!0),$(this).parents("tr").css("background-color","#ffffff")}),$(".disable-on-yield").add(".disable-on-yield a").add(".disable-on-yield i").add("label[for=pc]").add("input[name=pc]").add("label[for^=cost]").add("input[name^=cost]").add("label[for=price]").add("input[name=price]").add("label[for=discount]").add("input[name=discount]").add(".subselect.discount a").add(".subselect.pc a").add(".subselect.pc .glossary-inline").add(".subselect.pc .glossary-link-family").add(".subselect.discount i").add(".subselect.pc i").add(".subselect.discount .param-deadcell").add(".subselect.pc .param-deadcell").css("color","#999999"),$(".subselect.pc select").prop("disabled",!0)),$("input[name=figuredisplay]").change(function(){"yield"===$("input[name=figuredisplay]:checked").val()?($(".disable-on-yield-alert").slideDown("fast"),$("input[name=pc]").add("input[name^=cost]").add("input[name=price]").add("input[name=discount]").each(function(){$(this).prop("disabled",!0),$(this).parents("tr").css("background-color","#ffffff")}),$(".disable-on-yield").add(".disable-on-yield a").add(".disable-on-yield i").add("label[for=pc]").add("input[name=pc]").add("label[for^=cost]").add("input[name^=cost]").add("label[for=price]").add("input[name=price]").add("label[for=discount]").add("input[name=discount]").add(".subselect.discount a").add(".subselect.pc a").add(".subselect.pc .glossary-inline").add(".subselect.pc .glossary-link-family").add(".subselect.discount i").add(".subselect.pc i").add(".subselect.discount .param-deadcell").add(".subselect.pc .param-deadcell").css("color","#999999"),$(".subselect.pc select").prop("disabled",!0)):($(".disable-on-yield-alert").slideUp("fast"),$("input[name=pc]").add("input[name^=cost]").add("input[name=price]").add("input[name=discount]").each(function(){$(this).prop("disabled",!1),$(this).parents("tr").css("background-color","auto")}),$(".disable-on-yield").add(".disable-on-yield a").add(".disable-on-yield i").add("label[for=pc]").add("input[name=pc]").add("label[for^=cost]").add("input[name^=cost]").add("label[for=price]").add("input[name=price]").add("label[for=discount]").add("input[name=discount]").add(".subselect.discount a").add(".subselect.pc a").add(".subselect.pc .glossary-inline").add(".subselect.pc .glossary-link-family").add(".subselect.discount i").add(".subselect.pc i").add(".subselect.discount .param-deadcell").add(".subselect.pc .param-deadcell").css("color",""),$(".subselect.pc select").prop("disabled",!1))})}function setPracticeCost(e,a){d3.tsv("regional-assumptions.tsv",function(s){if("dp"===a)$("input[name=pc]").val("0");else if("hp"===a||"dbp"===a){var t;switch(e){case"napa":t=0;break;case"nsj":t=1;break;case"cc":t=2;break;case"lake":t=3;break;case"sonoma":t=4}$("input[name=pc]").val(s[t]["pc"+a])}})}function setPracticeSelect(e,a){0==a?$("select[name=practice]").val("dp"):d3.tsv("regional-assumptions.tsv",function(s){var t;switch(e){case"napa":t=0;break;case"nsj":t=1;break;case"cc":t=2;break;case"lake":t=3;break;case"sonoma":t=4}a==s[t].pchp?$("select[name=practice]").val("hp"):a==s[t].pcdbp?$("select[name=practice]").val("dbp"):$("select[name=practice]").val("custom")})}function checkRegionDisplay(e,a,s,t,i,n,c,o,l,d,r,p,u,f){d3.tsv("regional-assumptions.tsv",function(e){for(var b="custom",m=0;5>m;m++)a!=e[m].discount||s!=e[m].cost0||t!=e[m].cost1||i!=e[m].cost2||n!=e[m].cost3||c!=e[m].pchp&&c!=e[m].pcdbp&&0!=c||o!=e[m].price||l!=e[m].yield0||d!=e[m].yield1||r!=e[m].yield2||p!=e[m].yield3||u!=e[m].yield4||f!=e[m].yield5||(b=e[m].region);setRegionDisplay(b)})}function valueSwitch(e){var a;switch(e){case"price":a="price per ton";break;case"discount":a="discount rate";break;case"pc":a="preventative practice cost";break;case"cost0":a="year 0 cultural cost";break;case"cost1":a="year 1 cultural cost";break;case"cost2":a="year 2 cultural cost";break;case"cost3":a="year 3 cultural cost";break;case"yield0":a="year 0 yield";break;case"yield1":a="year 1 yield";break;case"yield2":a="year 2 yield";break;case"yield3":a="year 3 yield";break;case"yield4":a="year 4 yield";break;case"yield5":a="year 5+ yield"}return a}function regionSwitch(e,a){var s,t;switch(e){case"napa":t="Napa",s=0;break;case"nsj":t="Northern San Joaquin",s=1;break;case"cc":t="Central Coast",s=2;break;case"lake":t="Lake",s=3;break;case"sonoma":t="Sonoma",s=4;break;case"custom":t="Custom",s=1}return"friendly"===a?t:"index"===a?s:void 0}function setRegionDisplay(e){var a="custom"===e?"custom values.":'<span class="regionName">'+regionSwitch(e,"friendly")+"</span> default values.";$(".currentRegion").html(a+'<input type="hidden" id="region-basis" name="region-basis" value="'+e+'">')}function setRegionalDefaults(e){d3.tsv("regional-assumptions.tsv",function(a){var s=$("select[name=practice]").val(),t=regionSwitch(e,"index");$("input[name=price]").val(a[t].price),$("input[name=discount]").val(a[t].discount),$("input[name=cost0]").val(a[t].cost0),$("input[name=cost1]").val(a[t].cost1),$("input[name=cost2]").val(a[t].cost2),$("input[name=cost3]").val(a[t].cost3),$("input[name=yield0]").val(a[t].yield0),$("input[name=yield1]").val(a[t].yield1),$("input[name=yield2]").val(a[t].yield2),$("input[name=yield3]").val(a[t].yield3),$("input[name=yield4]").val(a[t].yield4),$("input[name=yield5]").val(a[t].yield5),"hp"!==s&&"dbp"!==s||$("input[name=pc]").val(a[t]["pc"+s]),setRegionDisplay(e)})}function zoomDisable(){$("head meta[name=viewport]").remove(),$("head").prepend('<meta name="viewport" content="user-scalable=0" />')}function zoomEnable(){$("head meta[name=viewport]").remove(),$("head").prepend('<meta name="viewport" content="user-scalable=1" />')}