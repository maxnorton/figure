function the_table(t,e,a,r,s,n,d,l,o,y,h,i){d3.tsv("yield-rates.tsv",function(p){var f,v,c,u,b,I,m,g,k,Y,w,x,F,D,C=new Array,E={healthy:null,untreated:null,"25y3":0,"50y3":0,"75y3":0,"25y5":0,"50y5":0,"75y5":0,"25y10":0,"50y10":0,"75y10":0},A={healthy:null,untreated:null,"25y3":0,"50y3":0,"75y3":0,"25y5":0,"50y5":0,"75y5":0,"25y10":0,"50y10":0,"75y10":0},N={healthy:0,untreated:1,"25y3":0,"50y3":0,"75y3":0,"25y5":0,"50y5":0,"75y5":0,"25y10":0,"50y10":0,"75y10":0},j={healthy:"Healthy, untreated",untreated:"Infected, untreated","25y3":"25% DCE treatment adopted year 3","50y3":"50% DCE treatment adopted year 3","75y3":"75% DCE treatment adopted year 3","25y5":"25% DCE treatment adopted year 5","50y5":"50% DCE treatment adopted year 5","75y5":"75% DCE treatment adopted year 5","25y10":"25% DCE treatment adopted year 10","50y10":"50% DCE treatment adopted year 10","75y10":"75% DCE treatment adopted year 10"},M=Object.keys(j),T=1/(1+t/100);healthyYields=[l,o,y,h,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i],untreatedYields=[];for(var B in healthyYields)untreatedYields[B]=healthyYields[B]*p[B].noAction/100;costs=[e,a,r,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s];var R=[];for(var B in untreatedYields)R[B]=d*untreatedYields[B]-costs[B];var _=[];for(var B in R){var O=Math.pow(T,B);_[B]=R[B]*O}for(var P=[_[0]],B=1;B<_.length;B++)P[B]=_[B]+P[B-1];for(var H=[d*healthyYields[0]-costs[0]],L,S="-",B=1;B<healthyYields.length;B++){var O=Math.pow(T,B);H[B]=(d*healthyYields[B]-costs[B])*O+H[parseInt(B-1)],H[B]>H[parseInt(B-1)]&&(L=H[B],S=B)}L=0>L?"-$"+parseFloat(-1*L).toFixed(2):"$"+parseFloat(L).toFixed(2);var U=-1;for(var B in H)if(H[B+1]>0){U=B;break}-1==U&&(U="Never breaks even",S="-"),f=[];for(var B in H)f[B]=H[B]-P[B];for(var q=0;P[q]<0&&25>q;)q++;if(25==q)q="Untreated vineyard never profitable";else for(;P[q]>0&&25>q;)q++;var z="<hr /><h2>Results</h2><table><thead><th><h4>Scenario</h4></th><th><h4>ACDNB in last profitable year</h4></th><th><h4>Breakeven age</h4></th><th><h4>Last profitable year</h4></th><th><h4>Breakeven probability</h4></th></thead><tbody>";z+="<tr><td>"+j.healthy+"</td><td>"+L+"</td><td>"+U+"</td><td>"+S+"</td><td>0</td></tr>",z+="<tr><td>"+j.untreated+"</td><td>-</td><td>-</td><td>"+q+"</td><td>1</td></tr>";for(var G=2;G<M.length;G++){for(var J=M[G],K=parseInt(J.substr(3)),Q=[],V=0;K>V;V++)Q[V]=0;for(var V=K;26>V;V++)Q[V]=n;var W=[];for(var B in healthyYields)W[B]=d*healthyYields[B]-costs[B]-Q[B];var X=[];for(var B in W){var O=Math.pow(T,B);X[B]=W[B]*O}for(var Z=[X[0]],B=1;B<X.length;B++)Z[B]=X[B]+Z[B-1];w=[];for(var B in healthyYields)w[B]=healthyYields[B]*p[B][J]/100;x=[];for(var B in w)x[B]=d*w[B]-costs[B]-Q[B];F=[];for(var B in x){var O=Math.pow(T,B);F[B]=x[B]*O}D=[F[0]];for(var B=1;B<F.length;B++)D[B]=F[B]+D[B-1];C=[parseInt(Q[0])];for(var B=1;B<X.length;B++)C[B]=parseInt(Q[B])+parseInt(C[B-1]);var tt=[];for(var B in D)tt[B]=D[B]-P[B];switch(J){case"25y3":v=tt;break;case"25y5":c=tt;break;case"25y10":u=tt;break;case"50y3":b=tt;break;case"50y5":I=tt;break;case"50y10":m=tt;break;case"75y3":g=tt;break;case"75y5":k=tt;break;case"75y10":Y=tt}for(var B in D)if(D[B]>P[B]){E[J]=B;break}for(0==E[J]&&D[0]<=P[0]&&(E[J]="Never breaks even"),A[J]=J.substr(3);x[parseInt(A[J])+1]<=0&&parseInt(A[J])<25;)A[J]++;if(25==parseInt(A[J]))A[J]="Treatment never profitable";else for(;x[parseInt(A[J])+1]>0&&parseInt(A[J])<25;)A[J]++;N[J]=(H[25]-Z[25])/(D[25]-Z[25]-(P[25]-H[25])),N[J]>1&&(N[J]=1),N[J]=N[J].toFixed(3);var et=null!=tt[parseInt(A[J])]?tt[parseFloat(A[J])].toFixed(2):"-";"-"!=et&&0>et?et="-$"+parseFloat(-1*et).toFixed(2):"-"!=et&&(et="$"+parseFloat(et).toFixed(2)),z+="<tr><td>"+j[J]+"</td><td>"+et+"</td><td>"+E[J]+"</td><td>"+A[J]+"</td><td>"+N[J]+"</td></tr>"}z+='</tbody></table><p class="print-link"><a href="javascript:window.print()"><i class="fa fa-print" aria-hidden="true"></i> Print these results.</a></p><p class="adjust-link"><a href="#form" onclick="$(\'body,html\').stop(true,true).animate({scrollTop: $(\'#form\').offset().top - $(\'header\').height()}, \'500\', \'swing\');">Adjust parameters</a></p>',$(".results").html(z),$("body,html").stop(!0,!0).animate({scrollTop:$("#results").offset().top-$("header").height()},"500","swing")})}function the_table_and_figure(t,e,a,r,s,n,d,l,o,y,h,i){d3.tsv("yield-rates.tsv",function(p){var f,v,c,u,b,I,m,g,k,Y,w,x,F,D,C=new Array,E={healthy:null,untreated:null,"25y3":0,"50y3":0,"75y3":0,"25y5":0,"50y5":0,"75y5":0,"25y10":0,"50y10":0,"75y10":0},A={healthy:null,untreated:null,"25y3":0,"50y3":0,"75y3":0,"25y5":0,"50y5":0,"75y5":0,"25y10":0,"50y10":0,"75y10":0},N={healthy:0,untreated:1,"25y3":0,"50y3":0,"75y3":0,"25y5":0,"50y5":0,"75y5":0,"25y10":0,"50y10":0,"75y10":0},j={healthy:"Healthy, untreated",untreated:"Infected, untreated","25y3":"25% DCE treatment adopted year 3","50y3":"50% DCE treatment adopted year 3","75y3":"75% DCE treatment adopted year 3","25y5":"25% DCE treatment adopted year 5","50y5":"50% DCE treatment adopted year 5","75y5":"75% DCE treatment adopted year 5","25y10":"25% DCE treatment adopted year 10","50y10":"50% DCE treatment adopted year 10","75y10":"75% DCE treatment adopted year 10"},M=Object.keys(j),T=1/(1+t/100);healthyYields=[parseInt(l),parseInt(o),parseInt(y),parseInt(h),parseInt(i),parseInt(i),parseInt(i),parseInt(i),parseInt(i),parseInt(i),parseInt(i),parseInt(i),parseInt(i),parseInt(i),parseInt(i),parseInt(i),parseInt(i),parseInt(i),parseInt(i),parseInt(i),parseInt(i),parseInt(i),parseInt(i),parseInt(i),parseInt(i),parseInt(i)],untreatedYields=[];for(var B in healthyYields)untreatedYields[B]=healthyYields[B]*p[B].noAction/100;costs=[e,a,r,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s];var R=[];for(var B in untreatedYields)R[B]=d*untreatedYields[B]-costs[B];var _=[];for(var B in R){var O=Math.pow(T,B);_[B]=R[B]*O}for(var P=[_[0]],B=1;B<_.length;B++)P[B]=_[B]+P[B-1];for(var H=[d*healthyYields[0]-costs[0]],L,S="-",B=1;B<healthyYields.length;B++){var O=Math.pow(T,B);H[B]=(d*healthyYields[B]-costs[B])*O+H[parseInt(B-1)],H[B]>H[parseInt(B-1)]&&(L=H[B],S=B)}L=0>L?"-$"+parseFloat(-1*L).toFixed(2):"$"+parseFloat(L).toFixed(2);var U=-1;for(var B in H)if(H[B+1]>0){U=B;break}-1==U&&(U="Never breaks even",S="-"),f=[];for(var B in H)f[B]=H[B]-P[B];for(var q=0;P[q]<0&&25>q;)q++;if(25==q)q="Untreated vineyard never profitable";else for(;P[q]>0&&25>q;)q++;var z="<hr /><h2>Results</h2><table><thead><th><h4>Scenario</h4></th><th><h4>ACDNB in last profitable year</h4></th><th><h4>Breakeven age</h4></th><th><h4>Last profitable year</h4></th><th><h4>Breakeven probability</h4></th></thead><tbody>";z+="<tr><td>"+j.healthy+"</td><td>"+L+"</td><td>"+U+"</td><td>"+S+"</td><td>0</td></tr>",z+="<tr><td>"+j.untreated+"</td><td>-</td><td>-</td><td>"+q+"</td><td>1</td></tr>";for(var G=2;G<M.length;G++){for(var J=M[G],K=parseInt(J.substr(3)),Q=[],V=0;K>V;V++)Q[V]=0;for(var V=K;26>V;V++)Q[V]=n;var W=[];for(var B in healthyYields)W[B]=d*healthyYields[B]-costs[B]-Q[B];var X=[];for(var B in W){var O=Math.pow(T,B);X[B]=W[B]*O}for(var Z=[X[0]],B=1;B<X.length;B++)Z[B]=X[B]+Z[B-1];w=[];for(var B in healthyYields)w[B]=healthyYields[B]*p[B][J]/100;x=[];for(var B in w)x[B]=d*w[B]-costs[B]-Q[B];F=[];for(var B in x){var O=Math.pow(T,B);F[B]=x[B]*O}D=[F[0]];for(var B=1;B<F.length;B++)D[B]=F[B]+D[B-1];C=[parseInt(Q[0])];for(var B=1;B<X.length;B++)C[B]=parseInt(Q[B])+parseInt(C[B-1]);var tt=[];for(var B in D)tt[B]=D[B]-P[B];switch(J){case"25y3":v=tt;break;case"25y5":c=tt;break;case"25y10":u=tt;break;case"50y3":b=tt;break;case"50y5":I=tt;break;case"50y10":m=tt;break;case"75y3":g=tt;break;case"75y5":k=tt;break;case"75y10":Y=tt}for(var B in D)if(D[B]>P[B]){E[J]=B;break}for(0==E[J]&&D[0]<=P[0]&&(E[J]="Never breaks even"),A[J]=J.substr(3);x[parseInt(A[J])+1]<=0&&parseInt(A[J])<25;)A[J]++;if(25==parseInt(A[J]))A[J]="Treatment never profitable";else for(;x[parseInt(A[J])+1]>0&&parseInt(A[J])<25;)A[J]++;N[J]=(H[25]-Z[25])/(D[25]-Z[25]-(P[25]-H[25])),N[J]>1&&(N[J]=1),N[J]=N[J].toFixed(3);var et=null!=tt[parseInt(A[J])]?tt[parseFloat(A[J])].toFixed(2):"-";"-"!=et&&0>et?et="-$"+parseFloat(-1*et).toFixed(2):"-"!=et&&(et="$"+parseFloat(et).toFixed(2)),z+="<tr><td>"+j[J]+"</td><td>"+et+"</td><td>"+E[J]+"</td><td>"+A[J]+"</td><td>"+N[J]+"</td></tr>"}z+='</tbody></table><p class="print-link"><a href="javascript:window.print()"><i class="fa fa-print" aria-hidden="true"></i> Print these results.</a></p><p class="adjust-link"><a href="#form" onclick="$(\'body,html\').stop(true,true).animate({scrollTop: $(\'#form\').offset().top - $(\'header\').height()}, \'500\', \'swing\');">Adjust parameters</a></p>',$(".results").html(z);var at=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25];console.log(at),console.log(healthyYields);var rt={top:20,right:20,bottom:30,left:50},st=960-rt.left-rt.right,nt=500-rt.top-rt.bottom,dt=d3.time.format("%d-%b-%y"),lt=d3.time.scale().range([0,st]),ot=d3.scale.linear().range([nt,0]),yt=d3.svg.axis().scale(lt).orient("bottom"),ht=d3.svg.axis().scale(ot).orient("left"),it=d3.svg.line().x(at).y(healthyYields);console.log(it);var pt=d3.select(".results").append("svg").attr("width",st+rt.left+rt.right).attr("height",nt+rt.top+rt.bottom).append("g").attr("transform","translate("+rt.left+","+rt.top+")");lt.domain(d3.extent(at)),ot.domain(d3.extent(healthyYields)),pt.append("g").attr("class","x axis").attr("transform","translate(0,"+nt+")").call(yt),pt.append("g").attr("class","y axis").call(ht).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("Yield (Tons/Acre)"),pt.append("path").datum(p).attr("class","line").attr("d",it)}),$("body,html").stop(!0,!0).animate({scrollTop:$("#results").offset().top-$("header").height()},"500","swing")}function type(t){return t.years=+t.years,t.healthyYields=+t.healthyYields,t}var t,a,eff,discount,cost0,cost1,cost2,cost3,pc,price,yield0,yield1,yield2,yield3,yield4,treatedCDNR,treatedDNR,treatedNR,treatedYields=new Array,costs,pcFtnOfT,isProfitable=new Array;